{"version":3,"file":"KeybindingPanel-CEtSyVJS.js","sources":["../../src/components/dialog/content/setting/keybinding/KeyComboDisplay.vue","../../src/components/dialog/content/setting/KeybindingPanel.vue"],"sourcesContent":["<template>\n  <span>\n    <template v-for=\"(sequence, index) in keySequences\" :key=\"index\">\n      <Tag :severity=\"isModified ? 'info' : 'secondary'\">\n        {{ sequence }}\n      </Tag>\n      <span v-if=\"index < keySequences.length - 1\" class=\"px-2\">+</span>\n    </template>\n  </span>\n</template>\n\n<script setup lang=\"ts\">\nimport Tag from 'primevue/tag'\nimport { computed } from 'vue'\n\nimport { KeyComboImpl } from '@/stores/keybindingStore'\n\nconst { keyCombo, isModified = false } = defineProps<{\n  keyCombo: KeyComboImpl\n  isModified?: boolean\n}>()\n\nconst keySequences = computed(() => keyCombo.getKeySequences())\n</script>\n","<template>\n  <PanelTemplate value=\"Keybinding\" class=\"keybinding-panel\">\n    <template #header>\n      <SearchBox\n        v-model=\"filters['global'].value\"\n        :placeholder=\"$t('g.searchKeybindings') + '...'\"\n      />\n    </template>\n\n    <DataTable\n      v-model:selection=\"selectedCommandData\"\n      :value=\"commandsData\"\n      :global-filter-fields=\"['id', 'label']\"\n      :filters=\"filters\"\n      selection-mode=\"single\"\n      striped-rows\n      :pt=\"{\n        header: 'px-0'\n      }\"\n      @row-dblclick=\"editKeybinding($event.data)\"\n    >\n      <Column field=\"actions\" header=\"\">\n        <template #body=\"slotProps\">\n          <div class=\"actions invisible flex flex-row\">\n            <Button\n              icon=\"pi pi-pencil\"\n              class=\"p-button-text\"\n              @click=\"editKeybinding(slotProps.data)\"\n            />\n            <Button\n              icon=\"pi pi-replay\"\n              class=\"p-button-text p-button-warn\"\n              :disabled=\"\n                !keybindingStore.isCommandKeybindingModified(slotProps.data.id)\n              \"\n              @click=\"resetKeybinding(slotProps.data)\"\n            />\n            <Button\n              icon=\"pi pi-trash\"\n              class=\"p-button-text p-button-danger\"\n              :disabled=\"!slotProps.data.keybinding\"\n              @click=\"removeKeybinding(slotProps.data)\"\n            />\n          </div>\n        </template>\n      </Column>\n      <Column\n        field=\"id\"\n        :header=\"$t('g.command')\"\n        sortable\n        class=\"max-w-64 2xl:max-w-full\"\n      >\n        <template #body=\"slotProps\">\n          <div\n            class=\"overflow-hidden text-ellipsis whitespace-nowrap\"\n            :title=\"slotProps.data.id\"\n          >\n            {{ slotProps.data.label }}\n          </div>\n        </template>\n      </Column>\n      <Column field=\"keybinding\" :header=\"$t('g.keybinding')\">\n        <template #body=\"slotProps\">\n          <KeyComboDisplay\n            v-if=\"slotProps.data.keybinding\"\n            :key-combo=\"slotProps.data.keybinding.combo\"\n            :is-modified=\"\n              keybindingStore.isCommandKeybindingModified(slotProps.data.id)\n            \"\n          />\n          <span v-else>-</span>\n        </template>\n      </Column>\n      <Column field=\"source\" :header=\"$t('g.source')\">\n        <template #body=\"slotProps\">\n          <span class=\"overflow-hidden text-ellipsis\">{{\n            slotProps.data.source || '-'\n          }}</span>\n        </template>\n      </Column>\n    </DataTable>\n\n    <Dialog\n      v-model:visible=\"editDialogVisible\"\n      class=\"min-w-96\"\n      modal\n      :header=\"currentEditingCommand?.label\"\n      @hide=\"cancelEdit\"\n    >\n      <div>\n        <InputText\n          ref=\"keybindingInput\"\n          class=\"mb-2 text-center\"\n          :model-value=\"newBindingKeyCombo?.toString() ?? ''\"\n          placeholder=\"Press keys for new binding\"\n          autocomplete=\"off\"\n          fluid\n          @keydown.stop.prevent=\"captureKeybinding\"\n        />\n        <Message v-if=\"existingKeybindingOnCombo\" severity=\"warn\">\n          Keybinding already exists on\n          <Tag\n            severity=\"secondary\"\n            :value=\"existingKeybindingOnCombo.commandId\"\n          />\n        </Message>\n      </div>\n      <template #footer>\n        <Button\n          :label=\"existingKeybindingOnCombo ? 'Overwrite' : 'Save'\"\n          :icon=\"existingKeybindingOnCombo ? 'pi pi-pencil' : 'pi pi-check'\"\n          :severity=\"existingKeybindingOnCombo ? 'warn' : undefined\"\n          autofocus\n          @click=\"saveKeybinding\"\n        />\n      </template>\n    </Dialog>\n    <Button\n      v-tooltip=\"$t('g.resetAllKeybindingsTooltip')\"\n      class=\"mt-4\"\n      :label=\"$t('g.resetAll')\"\n      icon=\"pi pi-replay\"\n      severity=\"danger\"\n      fluid\n      text\n      @click=\"resetAllKeybindings\"\n    />\n  </PanelTemplate>\n</template>\n\n<script setup lang=\"ts\">\nimport { FilterMatchMode } from '@primevue/core/api'\nimport Button from 'primevue/button'\nimport Column from 'primevue/column'\nimport DataTable from 'primevue/datatable'\nimport Dialog from 'primevue/dialog'\nimport InputText from 'primevue/inputtext'\nimport Message from 'primevue/message'\nimport Tag from 'primevue/tag'\nimport { useToast } from 'primevue/usetoast'\nimport { computed, ref, watchEffect } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport SearchBox from '@/components/common/SearchBox.vue'\nimport { useKeybindingService } from '@/services/keybindingService'\nimport { useCommandStore } from '@/stores/commandStore'\nimport {\n  KeyComboImpl,\n  KeybindingImpl,\n  useKeybindingStore\n} from '@/stores/keybindingStore'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\n\nimport PanelTemplate from './PanelTemplate.vue'\nimport KeyComboDisplay from './keybinding/KeyComboDisplay.vue'\n\nconst filters = ref({\n  global: { value: '', matchMode: FilterMatchMode.CONTAINS }\n})\n\nconst keybindingStore = useKeybindingStore()\nconst keybindingService = useKeybindingService()\nconst commandStore = useCommandStore()\nconst { t } = useI18n()\n\ninterface ICommandData {\n  id: string\n  keybinding: KeybindingImpl | null\n  label: string\n  source?: string\n}\n\nconst commandsData = computed<ICommandData[]>(() => {\n  return Object.values(commandStore.commands).map((command) => ({\n    id: command.id,\n    label: t(\n      `commands.${normalizeI18nKey(command.id)}.label`,\n      command.label ?? ''\n    ),\n    keybinding: keybindingStore.getKeybindingByCommandId(command.id),\n    source: command.source\n  }))\n})\n\nconst selectedCommandData = ref<ICommandData | null>(null)\nconst editDialogVisible = ref(false)\nconst newBindingKeyCombo = ref<KeyComboImpl | null>(null)\nconst currentEditingCommand = ref<ICommandData | null>(null)\nconst keybindingInput = ref<InstanceType<typeof InputText> | null>(null)\n\nconst existingKeybindingOnCombo = computed<KeybindingImpl | null>(() => {\n  if (!currentEditingCommand.value) {\n    return null\n  }\n\n  // If the new keybinding is the same as the current editing command, then don't show the error\n  if (\n    currentEditingCommand.value.keybinding?.combo?.equals(\n      newBindingKeyCombo.value\n    )\n  ) {\n    return null\n  }\n\n  if (!newBindingKeyCombo.value) {\n    return null\n  }\n\n  return keybindingStore.getKeybinding(newBindingKeyCombo.value)\n})\n\nfunction editKeybinding(commandData: ICommandData) {\n  currentEditingCommand.value = commandData\n  newBindingKeyCombo.value = commandData.keybinding\n    ? commandData.keybinding.combo\n    : null\n  editDialogVisible.value = true\n}\n\nwatchEffect(() => {\n  if (editDialogVisible.value) {\n    // nextTick doesn't work here, so we use a timeout instead\n    setTimeout(() => {\n      // @ts-expect-error - $el is an internal property of the InputText component\n      keybindingInput.value?.$el?.focus()\n    }, 300)\n  }\n})\n\nasync function removeKeybinding(commandData: ICommandData) {\n  if (commandData.keybinding) {\n    keybindingStore.unsetKeybinding(commandData.keybinding)\n    await keybindingService.persistUserKeybindings()\n  }\n}\n\nasync function captureKeybinding(event: KeyboardEvent) {\n  // Allow the use of keyboard shortcuts when adding keyboard shortcuts\n  if (!event.shiftKey && !event.altKey && !event.ctrlKey && !event.metaKey) {\n    switch (event.key) {\n      case 'Escape':\n        cancelEdit()\n        return\n      case 'Enter':\n        await saveKeybinding()\n        return\n    }\n  }\n  const keyCombo = KeyComboImpl.fromEvent(event)\n  newBindingKeyCombo.value = keyCombo\n}\n\nfunction cancelEdit() {\n  editDialogVisible.value = false\n  currentEditingCommand.value = null\n  newBindingKeyCombo.value = null\n}\n\nasync function saveKeybinding() {\n  if (currentEditingCommand.value && newBindingKeyCombo.value) {\n    const updated = keybindingStore.updateKeybindingOnCommand(\n      new KeybindingImpl({\n        commandId: currentEditingCommand.value.id,\n        combo: newBindingKeyCombo.value\n      })\n    )\n    if (updated) {\n      await keybindingService.persistUserKeybindings()\n    }\n  }\n  cancelEdit()\n}\n\nasync function resetKeybinding(commandData: ICommandData) {\n  if (keybindingStore.resetKeybindingForCommand(commandData.id)) {\n    await keybindingService.persistUserKeybindings()\n  } else {\n    console.warn(\n      `No changes made when resetting keybinding for command: ${commandData.id}`\n    )\n  }\n}\n\nconst toast = useToast()\nasync function resetAllKeybindings() {\n  keybindingStore.resetAllKeybindings()\n  await keybindingService.persistUserKeybindings()\n  toast.add({\n    severity: 'info',\n    summary: 'Info',\n    detail: 'All keybindings reset',\n    life: 3000\n  })\n}\n</script>\n\n<style scoped>\n:deep(.p-datatable-tbody) > tr > td {\n  @apply p-1;\n  min-height: 2rem;\n}\n\n:deep(.p-datatable-row-selected) .actions,\n:deep(.p-datatable-selectable-row:hover) .actions {\n  @apply visible;\n}\n</style>\n"],"names":["_createElementBlock","_openBlock","_Fragment","_renderList","_createVNode","_unref","Tag","isModified","_hoisted_1","_createBlock","PanelTemplate","$t","DataTable","Column","_withCtx","_createElementVNode","Button","KeyComboDisplay","_toDisplayString","Dialog","InputText","Message"],"mappings":"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"}